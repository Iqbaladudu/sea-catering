{"version":3,"file":"index.js","names":["getTranslation","hoistQueryParamsToAnd","transformColumnsToPreferences","React","Fragment","useCallback","useEffect","useState","Button","Pill","useEffectEvent","ChevronIcon","PlusIcon","useAuth","useConfig","ListQueryProvider","useServerFunctions","TableColumnsProvider","useTranslation","AnimateHeight","ColumnSelector","useDocumentDrawer","Popup","PopupList","RelationshipProvider","DrawerLink","RelationshipTablePagination","baseClass","RelationshipTable","props","AfterInput","allowCreate","BeforeInput","disableTable","field","fieldPath","filterOptions","initialData","initialDataFromProps","initialDrawerData","Label","parent","relationTo","Table","setTable","config","getEntityConfig","permissions","docs","Array","isArray","reduce","acc","doc","id","i18n","t","query","setQuery","openColumnSelector","setOpenColumnSelector","collectionConfig","collectionSlug","selectedCollection","setSelectedCollection","undefined","isLoadingTable","setIsLoadingTable","data","setData","columnState","setColumnState","getTableState","renderTable","newQuery","limit","String","defaultLimit","admin","pagination","sort","defaultSort","where","defaultColumns","map","accessor","active","newData","state","newColumnState","NewTable","columns","enableRowSelections","orderableFieldName","orderable","collection","name","renderRowTypes","tableAppearance","handleTableRender","DocumentDrawer","DocumentDrawerToggler","closeDrawer","isDrawerOpen","openDrawer","onDrawerSave","args","foundDocIndex","findIndex","withNewOrUpdatedDoc","newDocs","onDrawerCreate","onDrawerDelete","filter","canCreate","collections","create","_jsxs","className","_jsx","button","buttonStyle","buttonType","horizontalAlign","render","close","closePopup","ButtonGroup","relatedCollection","onClick","find","each","slug","labels","singular","size","icon","direction","pillStyle","length","label","plural","modifySearchParams","onQueryChange","replaceAll","LinkedCellOverride","height","onSave"],"sources":["../../../src/elements/RelationshipTable/index.tsx"],"sourcesContent":["'use client'\nimport { getTranslation } from '@payloadcms/translations'\nimport {\n  type CollectionSlug,\n  type Column,\n  type JoinFieldClient,\n  type ListQuery,\n  type PaginatedDocs,\n  type Where,\n} from 'payload'\nimport { hoistQueryParamsToAnd, transformColumnsToPreferences } from 'payload/shared'\nimport React, { Fragment, useCallback, useEffect, useState } from 'react'\n\nimport type { DocumentDrawerProps } from '../DocumentDrawer/types.js'\n\nimport { Button } from '../../elements/Button/index.js'\nimport { Pill } from '../../elements/Pill/index.js'\nimport { useEffectEvent } from '../../hooks/useEffectEvent.js'\nimport { ChevronIcon } from '../../icons/Chevron/index.js'\nimport { PlusIcon } from '../../icons/Plus/index.js'\nimport { useAuth } from '../../providers/Auth/index.js'\nimport { useConfig } from '../../providers/Config/index.js'\nimport { ListQueryProvider } from '../../providers/ListQuery/index.js'\nimport { useServerFunctions } from '../../providers/ServerFunctions/index.js'\nimport { TableColumnsProvider } from '../../providers/TableColumns/index.js'\nimport { useTranslation } from '../../providers/Translation/index.js'\nimport { AnimateHeight } from '../AnimateHeight/index.js'\nimport { ColumnSelector } from '../ColumnSelector/index.js'\nimport { useDocumentDrawer } from '../DocumentDrawer/index.js'\nimport { Popup, PopupList } from '../Popup/index.js'\nimport { RelationshipProvider } from '../Table/RelationshipProvider/index.js'\nimport { DrawerLink } from './cells/DrawerLink/index.js'\nimport { RelationshipTablePagination } from './Pagination.js'\nimport './index.scss'\n\nconst baseClass = 'relationship-table'\n\ntype RelationshipTableComponentProps = {\n  readonly AfterInput?: React.ReactNode\n  readonly allowCreate?: boolean\n  readonly BeforeInput?: React.ReactNode\n  readonly disableTable?: boolean\n  readonly field: JoinFieldClient\n  readonly fieldPath?: string\n  readonly filterOptions?: Where\n  readonly initialData?: PaginatedDocs\n  readonly initialDrawerData?: DocumentDrawerProps['initialData']\n  readonly Label?: React.ReactNode\n  readonly parent?: {\n    collectionSlug: CollectionSlug\n    id: number | string\n    joinPath: string\n  }\n  readonly relationTo: string | string[]\n}\n\nexport const RelationshipTable: React.FC<RelationshipTableComponentProps> = (props) => {\n  const {\n    AfterInput,\n    allowCreate = true,\n    BeforeInput,\n    disableTable = false,\n    field,\n    fieldPath,\n    filterOptions,\n    initialData: initialDataFromProps,\n    initialDrawerData,\n    Label,\n    parent,\n    relationTo,\n  } = props\n  const [Table, setTable] = useState<React.ReactNode>(null)\n  const { config, getEntityConfig } = useConfig()\n\n  const { permissions } = useAuth()\n\n  const [initialData] = useState<PaginatedDocs>(() => {\n    if (initialDataFromProps) {\n      return {\n        ...initialDataFromProps,\n        docs: Array.isArray(initialDataFromProps.docs)\n          ? initialDataFromProps.docs.reduce((acc, doc) => {\n              if (typeof doc === 'string') {\n                return [\n                  ...acc,\n                  {\n                    id: doc,\n                  },\n                ]\n              }\n              return [...acc, doc]\n            }, [])\n          : [],\n      }\n    }\n  })\n\n  const { i18n, t } = useTranslation()\n\n  const [query, setQuery] = useState<ListQuery>()\n  const [openColumnSelector, setOpenColumnSelector] = useState(false)\n\n  const [collectionConfig] = useState(() => getEntityConfig({ collectionSlug: relationTo }))\n\n  const [selectedCollection, setSelectedCollection] = useState(\n    Array.isArray(relationTo) ? undefined : relationTo,\n  )\n  const [isLoadingTable, setIsLoadingTable] = useState(!disableTable)\n  const [data, setData] = useState<PaginatedDocs>(initialData)\n  const [columnState, setColumnState] = useState<Column[]>()\n\n  const { getTableState } = useServerFunctions()\n\n  const renderTable = useCallback(\n    async (docs?: PaginatedDocs['docs']) => {\n      const newQuery: ListQuery = {\n        limit: String(field?.defaultLimit || collectionConfig?.admin?.pagination?.defaultLimit),\n        sort: field.defaultSort || collectionConfig?.defaultSort,\n        ...(query || {}),\n        where: { ...(query?.where || {}) },\n      }\n\n      if (filterOptions) {\n        newQuery.where = hoistQueryParamsToAnd(newQuery.where, filterOptions)\n      }\n\n      // map columns from string[] to ListPreferences['columns']\n      const defaultColumns = field.admin.defaultColumns\n        ? field.admin.defaultColumns.map((accessor) => ({\n            accessor,\n            active: true,\n          }))\n        : undefined\n\n      const {\n        data: newData,\n        state: newColumnState,\n        Table: NewTable,\n      } = await getTableState({\n        collectionSlug: relationTo,\n        columns: transformColumnsToPreferences(query?.columns) || defaultColumns,\n        docs,\n        enableRowSelections: false,\n        orderableFieldName:\n          !field.orderable || Array.isArray(field.collection)\n            ? undefined\n            : `_${field.collection}_${field.name}_order`,\n        parent,\n        query: newQuery,\n        renderRowTypes: true,\n        tableAppearance: 'condensed',\n      })\n\n      setData(newData)\n      setTable(NewTable)\n      setColumnState(newColumnState)\n      setIsLoadingTable(false)\n    },\n    [\n      field.defaultLimit,\n      field.defaultSort,\n      field.admin.defaultColumns,\n      field.collection,\n      field.name,\n      field.orderable,\n      collectionConfig?.admin?.pagination?.defaultLimit,\n      collectionConfig?.defaultSort,\n      query,\n      filterOptions,\n      getTableState,\n      relationTo,\n      parent,\n    ],\n  )\n\n  const handleTableRender = useEffectEvent((query: ListQuery, disableTable: boolean) => {\n    if (!disableTable && (!Table || query)) {\n      void renderTable()\n    }\n  })\n\n  useEffect(() => {\n    handleTableRender(query, disableTable)\n  }, [query, disableTable])\n\n  const [DocumentDrawer, DocumentDrawerToggler, { closeDrawer, isDrawerOpen, openDrawer }] =\n    useDocumentDrawer({\n      collectionSlug: selectedCollection,\n    })\n\n  const onDrawerSave = useCallback<DocumentDrawerProps['onSave']>(\n    (args) => {\n      const foundDocIndex = data?.docs?.findIndex((doc) => doc.id === args.doc.id)\n      let withNewOrUpdatedDoc: PaginatedDocs['docs'] = undefined\n\n      if (foundDocIndex !== -1) {\n        const newDocs = [...data.docs]\n        newDocs[foundDocIndex] = args.doc\n        withNewOrUpdatedDoc = newDocs\n      } else {\n        withNewOrUpdatedDoc = [args.doc, ...data.docs]\n      }\n\n      void renderTable(withNewOrUpdatedDoc)\n    },\n    [data?.docs, renderTable],\n  )\n\n  const onDrawerCreate = useCallback<DocumentDrawerProps['onSave']>(\n    (args) => {\n      closeDrawer()\n\n      void onDrawerSave(args)\n    },\n    [closeDrawer, onDrawerSave],\n  )\n\n  const onDrawerDelete = useCallback<DocumentDrawerProps['onDelete']>(\n    (args) => {\n      const newDocs = data.docs.filter((doc) => doc.id !== args.id)\n      void renderTable(newDocs)\n    },\n    [data?.docs, renderTable],\n  )\n\n  const canCreate =\n    allowCreate !== false &&\n    permissions?.collections?.[Array.isArray(relationTo) ? relationTo[0] : relationTo]?.create\n\n  useEffect(() => {\n    if (Array.isArray(relationTo) && selectedCollection) {\n      openDrawer()\n    }\n  }, [selectedCollection, openDrawer, relationTo])\n\n  useEffect(() => {\n    if (Array.isArray(relationTo) && !isDrawerOpen && selectedCollection) {\n      setSelectedCollection(undefined)\n    }\n    // eslint-disable-next-line react-compiler/react-compiler -- TODO: fix\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDrawerOpen])\n\n  return (\n    <div className={baseClass}>\n      <div className={`${baseClass}__header`}>\n        {Label}\n        <div className={`${baseClass}__actions`}>\n          {!Array.isArray(relationTo) && canCreate && (\n            <DocumentDrawerToggler className={`${baseClass}__add-new`}>\n              {i18n.t('fields:addNew')}\n            </DocumentDrawerToggler>\n          )}\n\n          {Array.isArray(relationTo) && (\n            <Fragment>\n              <Popup\n                button={\n                  <Button buttonStyle=\"none\" className={`${baseClass}__add-new-polymorphic`}>\n                    {i18n.t('fields:addNew')}\n                    <PlusIcon />\n                  </Button>\n                }\n                buttonType=\"custom\"\n                horizontalAlign=\"center\"\n                render={({ close: closePopup }) => (\n                  <PopupList.ButtonGroup>\n                    {relationTo.map((relatedCollection) => {\n                      if (permissions.collections[relatedCollection].create) {\n                        return (\n                          <PopupList.Button\n                            className={`${baseClass}__relation-button--${relatedCollection}`}\n                            key={relatedCollection}\n                            onClick={() => {\n                              closePopup()\n                              setSelectedCollection(relatedCollection)\n                            }}\n                          >\n                            {getTranslation(\n                              config.collections.find((each) => each.slug === relatedCollection)\n                                .labels.singular,\n                              i18n,\n                            )}\n                          </PopupList.Button>\n                        )\n                      }\n\n                      return null\n                    })}\n                  </PopupList.ButtonGroup>\n                )}\n                size=\"medium\"\n              />\n            </Fragment>\n          )}\n          <Pill\n            aria-controls={`${baseClass}-columns`}\n            aria-expanded={openColumnSelector}\n            className={`${baseClass}__toggle-columns ${\n              openColumnSelector ? `${baseClass}__buttons-active` : ''\n            }`}\n            icon={<ChevronIcon direction={openColumnSelector ? 'up' : 'down'} />}\n            onClick={() => setOpenColumnSelector(!openColumnSelector)}\n            pillStyle=\"light\"\n            size=\"small\"\n          >\n            {t('general:columns')}\n          </Pill>\n        </div>\n      </div>\n      {BeforeInput}\n      {isLoadingTable ? (\n        <p>{t('general:loading')}</p>\n      ) : (\n        <Fragment>\n          {data?.docs && data.docs.length === 0 && (\n            <div className={`${baseClass}__no-results`}>\n              <p>\n                {i18n.t('general:noResults', {\n                  label: Array.isArray(relationTo)\n                    ? i18n.t('general:documents')\n                    : getTranslation(collectionConfig?.labels?.plural, i18n),\n                })}\n              </p>\n              {canCreate && (\n                <Button onClick={openDrawer}>\n                  {i18n.t('general:createNewLabel', {\n                    label: getTranslation(collectionConfig?.labels?.singular, i18n),\n                  })}\n                </Button>\n              )}\n            </div>\n          )}\n          {data?.docs && data.docs.length > 0 && (\n            <RelationshipProvider>\n              <ListQueryProvider\n                columns={transformColumnsToPreferences(columnState)}\n                data={data}\n                defaultLimit={\n                  field.defaultLimit ?? collectionConfig?.admin?.pagination?.defaultLimit\n                }\n                defaultSort={field.defaultSort ?? collectionConfig?.defaultSort}\n                modifySearchParams={false}\n                onQueryChange={setQuery}\n                orderableFieldName={\n                  !field.orderable || Array.isArray(field.collection)\n                    ? undefined\n                    : `_${field.collection}_${fieldPath.replaceAll('.', '_')}_order`\n                }\n              >\n                <TableColumnsProvider\n                  collectionSlug={Array.isArray(relationTo) ? relationTo[0] : relationTo}\n                  columnState={columnState}\n                  LinkedCellOverride={\n                    <DrawerLink onDrawerDelete={onDrawerDelete} onDrawerSave={onDrawerSave} />\n                  }\n                >\n                  <AnimateHeight\n                    className={`${baseClass}__columns`}\n                    height={openColumnSelector ? 'auto' : 0}\n                    id={`${baseClass}-columns`}\n                  >\n                    <div className={`${baseClass}__columns-inner`}>\n                      {collectionConfig && (\n                        <ColumnSelector collectionSlug={collectionConfig.slug} />\n                      )}\n                    </div>\n                  </AnimateHeight>\n                  {Table}\n                  <RelationshipTablePagination />\n                </TableColumnsProvider>\n              </ListQueryProvider>\n            </RelationshipProvider>\n          )}\n        </Fragment>\n      )}\n      {AfterInput}\n      <DocumentDrawer initialData={initialDrawerData} onSave={onDrawerCreate} />\n    </div>\n  )\n}\n"],"mappings":"AAAA;;;AACA,SAASA,cAAc,QAAQ;AAS/B,SAASC,qBAAqB,EAAEC,6BAA6B,QAAQ;AACrE,OAAOC,KAAA,IAASC,QAAQ,EAAEC,WAAW,EAAEC,SAAS,EAAEC,QAAQ,QAAQ;AAIlE,SAASC,MAAM,QAAQ;AACvB,SAASC,IAAI,QAAQ;AACrB,SAASC,cAAc,QAAQ;AAC/B,SAASC,WAAW,QAAQ;AAC5B,SAASC,QAAQ,QAAQ;AACzB,SAASC,OAAO,QAAQ;AACxB,SAASC,SAAS,QAAQ;AAC1B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,kBAAkB,QAAQ;AACnC,SAASC,oBAAoB,QAAQ;AACrC,SAASC,cAAc,QAAQ;AAC/B,SAASC,aAAa,QAAQ;AAC9B,SAASC,cAAc,QAAQ;AAC/B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,KAAK,EAAEC,SAAS,QAAQ;AACjC,SAASC,oBAAoB,QAAQ;AACrC,SAASC,UAAU,QAAQ;AAC3B,SAASC,2BAA2B,QAAQ;AAC5C,OAAO;AAEP,MAAMC,SAAA,GAAY;AAqBlB,OAAO,MAAMC,iBAAA,GAAgEC,KAAA;EAC3E,MAAM;IACJC,UAAU;IACVC,WAAA,GAAc,IAAI;IAClBC,WAAW;IACXC,YAAA,GAAe,KAAK;IACpBC,KAAK;IACLC,SAAS;IACTC,aAAa;IACbC,WAAA,EAAaC,oBAAoB;IACjCC,iBAAiB;IACjBC,KAAK;IACLC,MAAM;IACNC;EAAU,CACX,GAAGb,KAAA;EACJ,MAAM,CAACc,KAAA,EAAOC,QAAA,CAAS,GAAGrC,QAAA,CAA0B;EACpD,MAAM;IAAEsC,MAAM;IAAEC;EAAe,CAAE,GAAGhC,SAAA;EAEpC,MAAM;IAAEiC;EAAW,CAAE,GAAGlC,OAAA;EAExB,MAAM,CAACwB,WAAA,CAAY,GAAG9B,QAAA,CAAwB;IAC5C,IAAI+B,oBAAA,EAAsB;MACxB,OAAO;QACL,GAAGA,oBAAoB;QACvBU,IAAA,EAAMC,KAAA,CAAMC,OAAO,CAACZ,oBAAA,CAAqBU,IAAI,IACzCV,oBAAA,CAAqBU,IAAI,CAACG,MAAM,CAAC,CAACC,GAAA,EAAKC,GAAA;UACrC,IAAI,OAAOA,GAAA,KAAQ,UAAU;YAC3B,OAAO,C,GACFD,GAAA,EACH;cACEE,EAAA,EAAID;YACN,EACD;UACH;UACA,OAAO,C,GAAID,GAAA,EAAKC,GAAA,CAAI;QACtB,GAAG,EAAE,IACL;MACN;IACF;EACF;EAEA,MAAM;IAAEE,IAAI;IAAEC;EAAC,CAAE,GAAGtC,cAAA;EAEpB,MAAM,CAACuC,KAAA,EAAOC,QAAA,CAAS,GAAGnD,QAAA;EAC1B,MAAM,CAACoD,kBAAA,EAAoBC,qBAAA,CAAsB,GAAGrD,QAAA,CAAS;EAE7D,MAAM,CAACsD,gBAAA,CAAiB,GAAGtD,QAAA,CAAS,MAAMuC,eAAA,CAAgB;IAAEgB,cAAA,EAAgBpB;EAAW;EAEvF,MAAM,CAACqB,kBAAA,EAAoBC,qBAAA,CAAsB,GAAGzD,QAAA,CAClD0C,KAAA,CAAMC,OAAO,CAACR,UAAA,IAAcuB,SAAA,GAAYvB,UAAA;EAE1C,MAAM,CAACwB,cAAA,EAAgBC,iBAAA,CAAkB,GAAG5D,QAAA,CAAS,CAAC0B,YAAA;EACtD,MAAM,CAACmC,IAAA,EAAMC,OAAA,CAAQ,GAAG9D,QAAA,CAAwB8B,WAAA;EAChD,MAAM,CAACiC,WAAA,EAAaC,cAAA,CAAe,GAAGhE,QAAA;EAEtC,MAAM;IAAEiE;EAAa,CAAE,GAAGxD,kBAAA;EAE1B,MAAMyD,WAAA,GAAcpE,WAAA,CAClB,MAAO2C,IAAA;IACL,MAAM0B,QAAA,GAAsB;MAC1BC,KAAA,EAAOC,MAAA,CAAO1C,KAAA,EAAO2C,YAAA,IAAgBhB,gBAAA,EAAkBiB,KAAA,EAAOC,UAAA,EAAYF,YAAA;MAC1EG,IAAA,EAAM9C,KAAA,CAAM+C,WAAW,IAAIpB,gBAAA,EAAkBoB,WAAA;MAC7C,IAAIxB,KAAA,IAAS,CAAC,CAAC;MACfyB,KAAA,EAAO;QAAE,IAAIzB,KAAA,EAAOyB,KAAA,IAAS,CAAC,CAAC;MAAE;IACnC;IAEA,IAAI9C,aAAA,EAAe;MACjBsC,QAAA,CAASQ,KAAK,GAAGjF,qBAAA,CAAsByE,QAAA,CAASQ,KAAK,EAAE9C,aAAA;IACzD;IAEA;IACA,MAAM+C,cAAA,GAAiBjD,KAAA,CAAM4C,KAAK,CAACK,cAAc,GAC7CjD,KAAA,CAAM4C,KAAK,CAACK,cAAc,CAACC,GAAG,CAAEC,QAAA,KAAc;MAC5CA,QAAA;MACAC,MAAA,EAAQ;IACV,MACArB,SAAA;IAEJ,MAAM;MACJG,IAAA,EAAMmB,OAAO;MACbC,KAAA,EAAOC,cAAc;MACrB9C,KAAA,EAAO+C;IAAQ,CAChB,GAAG,MAAMlB,aAAA,CAAc;MACtBV,cAAA,EAAgBpB,UAAA;MAChBiD,OAAA,EAASzF,6BAAA,CAA8BuD,KAAA,EAAOkC,OAAA,KAAYR,cAAA;MAC1DnC,IAAA;MACA4C,mBAAA,EAAqB;MACrBC,kBAAA,EACE,CAAC3D,KAAA,CAAM4D,SAAS,IAAI7C,KAAA,CAAMC,OAAO,CAAChB,KAAA,CAAM6D,UAAU,IAC9C9B,SAAA,GACA,IAAI/B,KAAA,CAAM6D,UAAU,IAAI7D,KAAA,CAAM8D,IAAI,QAAQ;MAChDvD,MAAA;MACAgB,KAAA,EAAOiB,QAAA;MACPuB,cAAA,EAAgB;MAChBC,eAAA,EAAiB;IACnB;IAEA7B,OAAA,CAAQkB,OAAA;IACR3C,QAAA,CAAS8C,QAAA;IACTnB,cAAA,CAAekB,cAAA;IACftB,iBAAA,CAAkB;EACpB,GACA,CACEjC,KAAA,CAAM2C,YAAY,EAClB3C,KAAA,CAAM+C,WAAW,EACjB/C,KAAA,CAAM4C,KAAK,CAACK,cAAc,EAC1BjD,KAAA,CAAM6D,UAAU,EAChB7D,KAAA,CAAM8D,IAAI,EACV9D,KAAA,CAAM4D,SAAS,EACfjC,gBAAA,EAAkBiB,KAAA,EAAOC,UAAA,EAAYF,YAAA,EACrChB,gBAAA,EAAkBoB,WAAA,EAClBxB,KAAA,EACArB,aAAA,EACAoC,aAAA,EACA9B,UAAA,EACAD,MAAA,CACD;EAGH,MAAM0D,iBAAA,GAAoBzF,cAAA,CAAe,CAAC+C,KAAA,EAAkBxB,YAAA;IAC1D,IAAI,CAACA,YAAA,KAAiB,CAACU,KAAA,IAASc,KAAI,GAAI;MACtC,KAAKgB,WAAA;IACP;EACF;EAEAnE,SAAA,CAAU;IACR6F,iBAAA,CAAkB1C,KAAA,EAAOxB,YAAA;EAC3B,GAAG,CAACwB,KAAA,EAAOxB,YAAA,CAAa;EAExB,MAAM,CAACmE,cAAA,EAAgBC,qBAAA,EAAuB;IAAEC,WAAW;IAAEC,YAAY;IAAEC;EAAU,CAAE,CAAC,GACtFnF,iBAAA,CAAkB;IAChByC,cAAA,EAAgBC;EAClB;EAEF,MAAM0C,YAAA,GAAepG,WAAA,CAClBqG,IAAA;IACC,MAAMC,aAAA,GAAgBvC,IAAA,EAAMpB,IAAA,EAAM4D,SAAA,CAAWvD,GAAA,IAAQA,GAAA,CAAIC,EAAE,KAAKoD,IAAA,CAAKrD,GAAG,CAACC,EAAE;IAC3E,IAAIuD,mBAAA,GAA6C5C,SAAA;IAEjD,IAAI0C,aAAA,KAAkB,CAAC,GAAG;MACxB,MAAMG,OAAA,GAAU,C,GAAI1C,IAAA,CAAKpB,IAAI,CAAC;MAC9B8D,OAAO,CAACH,aAAA,CAAc,GAAGD,IAAA,CAAKrD,GAAG;MACjCwD,mBAAA,GAAsBC,OAAA;IACxB,OAAO;MACLD,mBAAA,GAAsB,CAACH,IAAA,CAAKrD,GAAG,E,GAAKe,IAAA,CAAKpB,IAAI,CAAC;IAChD;IAEA,KAAKyB,WAAA,CAAYoC,mBAAA;EACnB,GACA,CAACzC,IAAA,EAAMpB,IAAA,EAAMyB,WAAA,CAAY;EAG3B,MAAMsC,cAAA,GAAiB1G,WAAA,CACpBqG,IAAA;IACCJ,WAAA;IAEA,KAAKG,YAAA,CAAaC,IAAA;EACpB,GACA,CAACJ,WAAA,EAAaG,YAAA,CAAa;EAG7B,MAAMO,cAAA,GAAiB3G,WAAA,CACpBqG,IAAA;IACC,MAAMI,OAAA,GAAU1C,IAAA,CAAKpB,IAAI,CAACiE,MAAM,CAAE5D,GAAA,IAAQA,GAAA,CAAIC,EAAE,KAAKoD,IAAA,CAAKpD,EAAE;IAC5D,KAAKmB,WAAA,CAAYqC,OAAA;EACnB,GACA,CAAC1C,IAAA,EAAMpB,IAAA,EAAMyB,WAAA,CAAY;EAG3B,MAAMyC,SAAA,GACJnF,WAAA,KAAgB,SAChBgB,WAAA,EAAaoE,WAAA,GAAclE,KAAA,CAAMC,OAAO,CAACR,UAAA,IAAcA,UAAU,CAAC,EAAE,GAAGA,UAAA,CAAW,EAAE0E,MAAA;EAEtF9G,SAAA,CAAU;IACR,IAAI2C,KAAA,CAAMC,OAAO,CAACR,UAAA,KAAeqB,kBAAA,EAAoB;MACnDyC,UAAA;IACF;EACF,GAAG,CAACzC,kBAAA,EAAoByC,UAAA,EAAY9D,UAAA,CAAW;EAE/CpC,SAAA,CAAU;IACR,IAAI2C,KAAA,CAAMC,OAAO,CAACR,UAAA,KAAe,CAAC6D,YAAA,IAAgBxC,kBAAA,EAAoB;MACpEC,qBAAA,CAAsBC,SAAA;IACxB;IACA;IACA;EACF,GAAG,CAACsC,YAAA,CAAa;EAEjB,oBACEc,KAAA,CAAC;IAAIC,SAAA,EAAW3F,SAAA;4BACd0F,KAAA,CAAC;MAAIC,SAAA,EAAW,GAAG3F,SAAA,UAAmB;iBACnCa,KAAA,E,aACD6E,KAAA,CAAC;QAAIC,SAAA,EAAW,GAAG3F,SAAA,WAAoB;mBACpC,CAACsB,KAAA,CAAMC,OAAO,CAACR,UAAA,KAAewE,SAAA,iBAC7BK,IAAA,CAAClB,qBAAA;UAAsBiB,SAAA,EAAW,GAAG3F,SAAA,WAAoB;oBACtD4B,IAAA,CAAKC,CAAC,CAAC;YAIXP,KAAA,CAAMC,OAAO,CAACR,UAAA,kBACb6E,IAAA,CAACnH,QAAA;oBACC,aAAAmH,IAAA,CAACjG,KAAA;YACCkG,MAAA,eACEH,KAAA,CAAC7G,MAAA;cAAOiH,WAAA,EAAY;cAAOH,SAAA,EAAW,GAAG3F,SAAA,uBAAgC;yBACtE4B,IAAA,CAAKC,CAAC,CAAC,kB,aACR+D,IAAA,CAAC3G,QAAA;;YAGL8G,UAAA,EAAW;YACXC,eAAA,EAAgB;YAChBC,MAAA,EAAQA,CAAC;cAAEC,KAAA,EAAOC;YAAU,CAAE,kBAC5BP,IAAA,CAAChG,SAAA,CAAUwG,WAAW;wBACnBrF,UAAA,CAAW0C,GAAG,CAAE4C,iBAAA;gBACf,IAAIjF,WAAA,CAAYoE,WAAW,CAACa,iBAAA,CAAkB,CAACZ,MAAM,EAAE;kBACrD,oBACEG,IAAA,CAAChG,SAAA,CAAUf,MAAM;oBACf8G,SAAA,EAAW,GAAG3F,SAAA,sBAA+BqG,iBAAA,EAAmB;oBAEhEC,OAAA,EAASA,CAAA;sBACPH,UAAA;sBACA9D,qBAAA,CAAsBgE,iBAAA;oBACxB;8BAEChI,cAAA,CACC6C,MAAA,CAAOsE,WAAW,CAACe,IAAI,CAAEC,IAAA,IAASA,IAAA,CAAKC,IAAI,KAAKJ,iBAAA,EAC7CK,MAAM,CAACC,QAAQ,EAClB/E,IAAA;qBATGyE,iBAAA;gBAaX;gBAEA,OAAO;cACT;;YAGJO,IAAA,EAAK;;yBAIXhB,IAAA,CAAC9G,IAAA;UACC,iBAAe,GAAGkB,SAAA,UAAmB;UACrC,iBAAegC,kBAAA;UACf2D,SAAA,EAAW,GAAG3F,SAAA,oBACZgC,kBAAA,GAAqB,GAAGhC,SAAA,kBAA2B,GAAG,IACtD;UACF6G,IAAA,eAAMjB,IAAA,CAAC5G,WAAA;YAAY8H,SAAA,EAAW9E,kBAAA,GAAqB,OAAO;;UAC1DsE,OAAA,EAASA,CAAA,KAAMrE,qBAAA,CAAsB,CAACD,kBAAA;UACtC+E,SAAA,EAAU;UACVH,IAAA,EAAK;oBAEJ/E,CAAA,CAAE;;;QAIRxB,WAAA,EACAkC,cAAA,gBACCqD,IAAA,CAAC;gBAAG/D,CAAA,CAAE;sBAEN6D,KAAA,CAACjH,QAAA;iBACEgE,IAAA,EAAMpB,IAAA,IAAQoB,IAAA,CAAKpB,IAAI,CAAC2F,MAAM,KAAK,kBAClCtB,KAAA,CAAC;QAAIC,SAAA,EAAW,GAAG3F,SAAA,cAAuB;gCACxC4F,IAAA,CAAC;oBACEhE,IAAA,CAAKC,CAAC,CAAC,qBAAqB;YAC3BoF,KAAA,EAAO3F,KAAA,CAAMC,OAAO,CAACR,UAAA,IACjBa,IAAA,CAAKC,CAAC,CAAC,uBACPxD,cAAA,CAAe6D,gBAAA,EAAkBwE,MAAA,EAAQQ,MAAA,EAAQtF,IAAA;UACvD;YAED2D,SAAA,iBACCK,IAAA,CAAC/G,MAAA;UAAOyH,OAAA,EAASzB,UAAA;oBACdjD,IAAA,CAAKC,CAAC,CAAC,0BAA0B;YAChCoF,KAAA,EAAO5I,cAAA,CAAe6D,gBAAA,EAAkBwE,MAAA,EAAQC,QAAA,EAAU/E,IAAA;UAC5D;;UAKPa,IAAA,EAAMpB,IAAA,IAAQoB,IAAA,CAAKpB,IAAI,CAAC2F,MAAM,GAAG,kBAChCpB,IAAA,CAAC/F,oBAAA;kBACC,aAAA+F,IAAA,CAACxG,iBAAA;UACC4E,OAAA,EAASzF,6BAAA,CAA8BoE,WAAA;UACvCF,IAAA,EAAMA,IAAA;UACNS,YAAA,EACE3C,KAAA,CAAM2C,YAAY,IAAIhB,gBAAA,EAAkBiB,KAAA,EAAOC,UAAA,EAAYF,YAAA;UAE7DI,WAAA,EAAa/C,KAAA,CAAM+C,WAAW,IAAIpB,gBAAA,EAAkBoB,WAAA;UACpD6D,kBAAA,EAAoB;UACpBC,aAAA,EAAerF,QAAA;UACfmC,kBAAA,EACE,CAAC3D,KAAA,CAAM4D,SAAS,IAAI7C,KAAA,CAAMC,OAAO,CAAChB,KAAA,CAAM6D,UAAU,IAC9C9B,SAAA,GACA,IAAI/B,KAAA,CAAM6D,UAAU,IAAI5D,SAAA,CAAU6G,UAAU,CAAC,KAAK,YAAY;oBAGpE,aAAA3B,KAAA,CAACpG,oBAAA;YACC6C,cAAA,EAAgBb,KAAA,CAAMC,OAAO,CAACR,UAAA,IAAcA,UAAU,CAAC,EAAE,GAAGA,UAAA;YAC5D4B,WAAA,EAAaA,WAAA;YACb2E,kBAAA,eACE1B,IAAA,CAAC9F,UAAA;cAAWuF,cAAA,EAAgBA,cAAA;cAAgBP,YAAA,EAAcA;;oCAG5Dc,IAAA,CAACpG,aAAA;cACCmG,SAAA,EAAW,GAAG3F,SAAA,WAAoB;cAClCuH,MAAA,EAAQvF,kBAAA,GAAqB,SAAS;cACtCL,EAAA,EAAI,GAAG3B,SAAA,UAAmB;wBAE1B,aAAA4F,IAAA,CAAC;gBAAID,SAAA,EAAW,GAAG3F,SAAA,iBAA0B;0BAC1CkC,gBAAA,iBACC0D,IAAA,CAACnG,cAAA;kBAAe0C,cAAA,EAAgBD,gBAAA,CAAiBuE;;;gBAItDzF,KAAA,E,aACD4E,IAAA,CAAC7F,2BAAA;;;;QAOZI,UAAA,E,aACDyF,IAAA,CAACnB,cAAA;MAAe/D,WAAA,EAAaE,iBAAA;MAAmB4G,MAAA,EAAQpC;;;AAG9D","ignoreList":[]}