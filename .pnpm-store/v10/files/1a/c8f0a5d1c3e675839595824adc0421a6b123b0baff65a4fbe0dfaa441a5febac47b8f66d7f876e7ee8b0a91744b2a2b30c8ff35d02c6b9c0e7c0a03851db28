{"version":3,"file":"refresh.js","names":["headers","nextHeaders","getPayload","getExistingAuthToken","setPayloadAuthCookie","refresh","collection","config","payload","authConfig","collections","auth","Error","user","existingCookie","cookiePrefix","message","success","token","value","e","console","error"],"sources":["../../src/auth/refresh.ts"],"sourcesContent":["'use server'\n\nimport type { CollectionSlug } from 'payload'\n\nimport { headers as nextHeaders } from 'next/headers.js'\nimport { getPayload } from 'payload'\n\nimport { getExistingAuthToken } from '../utilities/getExistingAuthToken.js'\nimport { setPayloadAuthCookie } from '../utilities/setPayloadAuthCookie.js'\n\nexport async function refresh({ collection, config }: { collection: CollectionSlug; config: any }) {\n  try {\n    const payload = await getPayload({ config })\n    const authConfig = payload.collections[collection]?.config.auth\n\n    if (!authConfig) {\n      throw new Error(`No auth config found for collection: ${collection}`)\n    }\n\n    const { user } = await payload.auth({ headers: await nextHeaders() })\n    if (!user) {\n      throw new Error('User not authenticated')\n    }\n\n    const existingCookie = await getExistingAuthToken(payload.config.cookiePrefix)\n\n    if (!existingCookie) {\n      return { message: 'No valid token found', success: false }\n    }\n\n    await setPayloadAuthCookie({\n      authConfig,\n      cookiePrefix: payload.config.cookiePrefix,\n      token: existingCookie.value,\n    })\n\n    return { message: 'Token refreshed successfully', success: true }\n  } catch (e) {\n    console.error('Refresh error:', e)\n    throw new Error(`${e}`)\n  }\n}\n"],"mappings":"AAAA;;AAIA,SAASA,OAAA,IAAWC,WAAW,QAAQ;AACvC,SAASC,UAAU,QAAQ;AAE3B,SAASC,oBAAoB,QAAQ;AACrC,SAASC,oBAAoB,QAAQ;AAErC,OAAO,eAAeC,QAAQ;EAAEC,UAAU;EAAEC;AAAM,CAA+C;EAC/F,IAAI;IACF,MAAMC,OAAA,GAAU,MAAMN,UAAA,CAAW;MAAEK;IAAO;IAC1C,MAAME,UAAA,GAAaD,OAAA,CAAQE,WAAW,CAACJ,UAAA,CAAW,EAAEC,MAAA,CAAOI,IAAA;IAE3D,IAAI,CAACF,UAAA,EAAY;MACf,MAAM,IAAIG,KAAA,CAAM,wCAAwCN,UAAA,EAAY;IACtE;IAEA,MAAM;MAAEO;IAAI,CAAE,GAAG,MAAML,OAAA,CAAQG,IAAI,CAAC;MAAEX,OAAA,EAAS,MAAMC,WAAA;IAAc;IACnE,IAAI,CAACY,IAAA,EAAM;MACT,MAAM,IAAID,KAAA,CAAM;IAClB;IAEA,MAAME,cAAA,GAAiB,MAAMX,oBAAA,CAAqBK,OAAA,CAAQD,MAAM,CAACQ,YAAY;IAE7E,IAAI,CAACD,cAAA,EAAgB;MACnB,OAAO;QAAEE,OAAA,EAAS;QAAwBC,OAAA,EAAS;MAAM;IAC3D;IAEA,MAAMb,oBAAA,CAAqB;MACzBK,UAAA;MACAM,YAAA,EAAcP,OAAA,CAAQD,MAAM,CAACQ,YAAY;MACzCG,KAAA,EAAOJ,cAAA,CAAeK;IACxB;IAEA,OAAO;MAAEH,OAAA,EAAS;MAAgCC,OAAA,EAAS;IAAK;EAClE,EAAE,OAAOG,CAAA,EAAG;IACVC,OAAA,CAAQC,KAAK,CAAC,kBAAkBF,CAAA;IAChC,MAAM,IAAIR,KAAA,CAAM,GAAGQ,CAAA,EAAG;EACxB;AACF","ignoreList":[]}