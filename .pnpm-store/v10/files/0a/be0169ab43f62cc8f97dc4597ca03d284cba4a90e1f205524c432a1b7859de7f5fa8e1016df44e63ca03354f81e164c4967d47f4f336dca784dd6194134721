{"version":3,"file":"fieldReducer.js","names":["ObjectIdImport","dequal","deepCopyObjectSimpleWithoutReactComponents","mergeServerFormState","flattenRows","separateRows","ObjectId","default","fieldReducer","state","action","type","blockType","path","rowIndex","rowIndexFromArgs","subFieldState","rows","length","withNewRow","newRow","id","value","toHexString","collapsed","isLoading","splice","initialValue","valid","remainingFields","siblingRows","newState","passesCondition","disableFormData","errorPaths","errors","forEach","message","fieldPath","errorMessage","segments","split","push","fieldErrorPath","parentPath","slice","join","Object","entries","reduce","acc","fieldState","fieldErrorPaths","errorACC","startsWith","changed","newErrorPaths","Array","isArray","includes","rowsMetadata","duplicateRowMetadata","duplicateRowState","key","keys","filter","endsWith","idState","isValid","acceptValues","prevStateRef","serverState","currentState","incomingState","current","moveFromIndex","moveToIndex","topLevelRows","copyOfMovingRow","rowsWithinField","copyOfMovingRow2","rowIndexArg","Math","max","min","undefined","optimize","newField","oldField","sanitize","field","values","updatedRows","formState"],"sources":["../../../src/forms/Form/fieldReducer.ts"],"sourcesContent":["'use client'\nimport type { FormField, FormState, Row } from 'payload'\n\nimport ObjectIdImport from 'bson-objectid'\nimport { dequal } from 'dequal/lite' // lite: no need for Map and Set support\nimport { deepCopyObjectSimpleWithoutReactComponents } from 'payload/shared'\n\nimport type { FieldAction } from './types.js'\n\nimport { mergeServerFormState } from './mergeServerFormState.js'\nimport { flattenRows, separateRows } from './rows.js'\n\nconst ObjectId = (ObjectIdImport.default ||\n  ObjectIdImport) as unknown as typeof ObjectIdImport.default\n\n/**\n * Reducer which modifies the form field state (all the current data of the fields in the form). When called using dispatch, it will return a new state object.\n */\nexport function fieldReducer(state: FormState, action: FieldAction): FormState {\n  switch (action.type) {\n    case 'ADD_ROW': {\n      const { blockType, path, rowIndex: rowIndexFromArgs, subFieldState = {} } = action\n\n      const rowIndex =\n        typeof rowIndexFromArgs === 'number' ? rowIndexFromArgs : state[path]?.rows?.length || 0\n\n      const withNewRow = [...(state[path]?.rows || [])]\n\n      const newRow: Row = {\n        id: (subFieldState?.id?.value as string) || new ObjectId().toHexString(),\n        collapsed: false,\n        isLoading: true,\n      }\n\n      if (blockType) {\n        newRow.blockType = blockType\n      }\n\n      withNewRow.splice(rowIndex, 0, newRow)\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // add new row to array _field state_\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n\n      siblingRows.splice(rowIndex, 0, subFieldState)\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [`${path}.${rowIndex}.id`]: {\n          initialValue: newRow.id,\n          passesCondition: true,\n          valid: true,\n          value: newRow.id,\n        },\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: withNewRow,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'ADD_SERVER_ERRORS': {\n      let newState = { ...state }\n\n      const errorPaths: { fieldErrorPath: string; parentPath: string }[] = []\n\n      action.errors.forEach(({ message, path: fieldPath }) => {\n        newState[fieldPath] = {\n          ...(newState[fieldPath] || {\n            initialValue: null,\n            value: null,\n          }),\n          errorMessage: message,\n          valid: false,\n        }\n\n        const segments = fieldPath.split('.')\n        if (segments.length > 1) {\n          errorPaths.push({\n            fieldErrorPath: fieldPath,\n            parentPath: segments.slice(0, segments.length - 1).join('.'),\n          })\n        }\n      })\n\n      newState = Object.entries(newState).reduce((acc, [path, fieldState]) => {\n        const fieldErrorPaths = errorPaths.reduce((errorACC, { fieldErrorPath, parentPath }) => {\n          if (parentPath.startsWith(path)) {\n            errorACC.push(fieldErrorPath)\n          }\n          return errorACC\n        }, [])\n\n        let changed = false\n\n        if (fieldErrorPaths.length > 0) {\n          const newErrorPaths = Array.isArray(fieldState.errorPaths) ? fieldState.errorPaths : []\n\n          fieldErrorPaths.forEach((fieldErrorPath) => {\n            if (!newErrorPaths.includes(fieldErrorPath)) {\n              newErrorPaths.push(fieldErrorPath)\n              changed = true\n            }\n          })\n\n          if (changed) {\n            acc[path] = {\n              ...fieldState,\n              errorPaths: newErrorPaths,\n            }\n          }\n        }\n\n        if (!changed) {\n          acc[path] = fieldState\n        }\n\n        return acc\n      }, {})\n\n      return newState\n    }\n\n    case 'DUPLICATE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path].rows || [])]\n\n      const duplicateRowMetadata = deepCopyObjectSimpleWithoutReactComponents(\n        rowsMetadata[rowIndex],\n      )\n\n      if (duplicateRowMetadata.id) {\n        duplicateRowMetadata.id = new ObjectId().toHexString()\n      }\n\n      const duplicateRowState = deepCopyObjectSimpleWithoutReactComponents(rows[rowIndex])\n\n      if (duplicateRowState.id) {\n        duplicateRowState.id.value = new ObjectId().toHexString()\n        duplicateRowState.id.initialValue = new ObjectId().toHexString()\n      }\n\n      for (const key of Object.keys(duplicateRowState).filter((key) => key.endsWith('.id'))) {\n        const idState = duplicateRowState[key]\n\n        if (idState && typeof idState.value === 'string' && ObjectId.isValid(idState.value)) {\n          duplicateRowState[key].value = new ObjectId().toHexString()\n          duplicateRowState[key].initialValue = new ObjectId().toHexString()\n        }\n      }\n\n      // If there are subfields\n      if (Object.keys(duplicateRowState).length > 0) {\n        // Add new object containing subfield names to unflattenedRows array\n        rows.splice(rowIndex + 1, 0, duplicateRowState)\n        rowsMetadata.splice(rowIndex + 1, 0, duplicateRowMetadata)\n      }\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, rows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'MERGE_SERVER_STATE': {\n      const { acceptValues, prevStateRef, serverState } = action\n\n      const newState = mergeServerFormState({\n        acceptValues,\n        currentState: state || {},\n        incomingState: serverState,\n      })\n\n      prevStateRef.current = newState\n\n      return newState\n    }\n\n    case 'MOVE_ROW': {\n      const { moveFromIndex, moveToIndex, path } = action\n\n      // Handle moving rows on the top-level, i.e. `array.0.text` -> `array.1.text`\n      const { remainingFields, rows: topLevelRows } = separateRows(path, state)\n      const copyOfMovingRow = topLevelRows[moveFromIndex]\n      topLevelRows.splice(moveFromIndex, 1)\n      topLevelRows.splice(moveToIndex, 0, copyOfMovingRow)\n\n      // modify array/block internal row state (i.e. collapsed, blockType)\n      const rowsWithinField = [...(state[path]?.rows || [])]\n      const copyOfMovingRow2 = { ...rowsWithinField[moveFromIndex] }\n      rowsWithinField.splice(moveFromIndex, 1)\n      rowsWithinField.splice(moveToIndex, 0, copyOfMovingRow2)\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, topLevelRows),\n        [path]: {\n          ...state[path],\n          rows: rowsWithinField,\n        },\n      }\n\n      return newState\n    }\n\n    case 'REMOVE': {\n      const newState = { ...state }\n      if (newState[action.path]) {\n        delete newState[action.path]\n      }\n      return newState\n    }\n\n    case 'REMOVE_ROW': {\n      const { path, rowIndex } = action\n      const { remainingFields, rows } = separateRows(path, state)\n      const rowsMetadata = [...(state[path]?.rows || [])]\n\n      rows.splice(rowIndex, 1)\n      rowsMetadata.splice(rowIndex, 1)\n\n      const newState: FormState = {\n        ...remainingFields,\n        [path]: {\n          ...state[path],\n          disableFormData: rows.length > 0,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n        ...flattenRows(path, rows),\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_ROW': {\n      const { blockType, path, rowIndex: rowIndexArg, subFieldState = {} } = action\n\n      const { remainingFields, rows: siblingRows } = separateRows(path, state)\n      const rowIndex = Math.max(0, Math.min(rowIndexArg, siblingRows?.length - 1 || 0))\n\n      const rowsMetadata = [...(state[path]?.rows || [])]\n      rowsMetadata[rowIndex] = {\n        id: new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n      }\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        }\n      }\n\n      // replace form _field state_\n      siblingRows[rowIndex] = subFieldState\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: siblingRows.length,\n        },\n      }\n\n      return newState\n    }\n\n    case 'REPLACE_STATE': {\n      if (action.optimize !== false) {\n        // Only update fields that have changed\n        // by comparing old value / initialValue to new\n        // ..\n        // This is a performance enhancement for saving\n        // large documents with hundreds of fields\n        const newState: FormState = {}\n\n        for (const [path, newField] of Object.entries(action.state)) {\n          const oldField = state[path]\n\n          if (newField.valid !== false) {\n            newField.valid = true\n          }\n          if (newField.passesCondition !== false) {\n            newField.passesCondition = true\n          }\n\n          if (!dequal(oldField, newField)) {\n            newState[path] = newField\n          } else if (oldField) {\n            newState[path] = oldField\n          }\n        }\n\n        return newState\n      }\n\n      // TODO: Remove this in 4.0 - this is a temporary fix to prevent a breaking change\n      if (action.sanitize) {\n        for (const field of Object.values(action.state)) {\n          if (field.valid !== false) {\n            field.valid = true\n          }\n          if (field.passesCondition !== false) {\n            field.passesCondition = true\n          }\n        }\n      }\n      // If we're not optimizing, just set the state to the new state\n      return action.state\n    }\n\n    case 'SET_ALL_ROWS_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      return {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n    }\n\n    case 'SET_ROW_COLLAPSED': {\n      const { path, updatedRows } = action\n\n      const newState = {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      }\n\n      return newState\n    }\n\n    case 'UPDATE': {\n      const newField = Object.entries(action).reduce(\n        (field, [key, value]) => {\n          if (\n            [\n              'disableFormData',\n              'errorMessage',\n              'initialValue',\n              'rows',\n              'valid',\n              'validate',\n              'value',\n            ].includes(key)\n          ) {\n            return {\n              ...field,\n              [key]: value,\n            }\n          }\n\n          return field\n        },\n        state?.[action.path] || ({} as FormField),\n      )\n\n      const newState = {\n        ...state,\n        [action.path]: newField,\n      }\n\n      return newState\n    }\n\n    case 'UPDATE_MANY': {\n      const newState = { ...state }\n\n      Object.entries(action.formState).forEach(([path, field]) => {\n        newState[path] = field\n      })\n\n      return newState\n    }\n\n    default: {\n      return state\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}