{"version":3,"file":"reducer.js","names":["formsManagementReducer","state","action","type","newForms","i","files","length","errorCount","formState","initialState","file","initialValue","valid","value","uploadEdits","activeIndex","forms","remainingFormStates","removedForm","splice","index","affectedByShift","nextIndex","boundedActiveIndex","Math","min","totalErrorCount","count","reduce","acc","form","updatedForms"],"sources":["../../../../src/elements/BulkUpload/FormsManager/reducer.ts"],"sourcesContent":["import type { FormState, UploadEdits } from 'payload'\n\nexport type State = {\n  activeIndex: number\n  forms: {\n    errorCount: number\n    formState: FormState\n    uploadEdits?: UploadEdits\n  }[]\n  totalErrorCount: number\n}\n\ntype Action =\n  | {\n      count: number\n      index: number\n      type: 'UPDATE_ERROR_COUNT'\n    }\n  | {\n      errorCount: number\n      formState: FormState\n      index: number\n      type: 'UPDATE_FORM'\n      updatedFields?: Record<string, unknown>\n      uploadEdits?: UploadEdits\n    }\n  | {\n      files: FileList\n      initialState: FormState | null\n      type: 'ADD_FORMS'\n    }\n  | {\n      index: number\n      type: 'REMOVE_FORM'\n    }\n  | {\n      index: number\n      type: 'SET_ACTIVE_INDEX'\n    }\n  | {\n      state: Partial<State>\n      type: 'REPLACE'\n    }\n\nexport function formsManagementReducer(state: State, action: Action): State {\n  switch (action.type) {\n    case 'ADD_FORMS': {\n      const newForms: State['forms'] = []\n      for (let i = 0; i < action.files.length; i++) {\n        newForms[i] = {\n          errorCount: 0,\n          formState: {\n            ...(action.initialState || {}),\n            file: {\n              initialValue: action.files[i],\n              valid: true,\n              value: action.files[i],\n            },\n          },\n          uploadEdits: {},\n        }\n      }\n\n      return {\n        ...state,\n        activeIndex: 0,\n        forms: [...newForms, ...state.forms],\n      }\n    }\n    case 'REMOVE_FORM': {\n      const remainingFormStates = [...state.forms]\n      const [removedForm] = remainingFormStates.splice(action.index, 1)\n\n      const affectedByShift = state.activeIndex >= action.index\n      const nextIndex =\n        state.activeIndex === action.index\n          ? action.index\n          : affectedByShift\n            ? state.activeIndex - 1\n            : state.activeIndex\n      const boundedActiveIndex = Math.min(remainingFormStates.length - 1, nextIndex)\n\n      return {\n        ...state,\n        activeIndex: affectedByShift ? boundedActiveIndex : state.activeIndex,\n        forms: remainingFormStates,\n        totalErrorCount: state.totalErrorCount - removedForm.errorCount,\n      }\n    }\n    case 'REPLACE': {\n      return {\n        ...state,\n        ...action.state,\n      }\n    }\n    case 'SET_ACTIVE_INDEX': {\n      return {\n        ...state,\n        activeIndex: action.index,\n      }\n    }\n    case 'UPDATE_ERROR_COUNT': {\n      const forms = [...state.forms]\n      forms[action.index].errorCount = action.count\n\n      return {\n        ...state,\n        forms,\n        totalErrorCount: state.forms.reduce((acc, form) => acc + form.errorCount, 0),\n      }\n    }\n    case 'UPDATE_FORM': {\n      const updatedForms = [...state.forms]\n      updatedForms[action.index].errorCount = action.errorCount\n\n      // Merge the existing formState with the new formState\n      updatedForms[action.index] = {\n        ...updatedForms[action.index],\n        formState: {\n          ...updatedForms[action.index].formState,\n          ...action.formState,\n        },\n        uploadEdits: {\n          ...updatedForms[action.index].uploadEdits,\n          ...action.uploadEdits,\n        },\n      }\n\n      return {\n        ...state,\n        forms: updatedForms,\n        totalErrorCount: state.forms.reduce((acc, form) => acc + form.errorCount, 0),\n      }\n    }\n    default: {\n      return state\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}